<<<<<<< HEAD
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Promise</title>
    <script>
        function callback() {
            console.log('done');
        }
        console.log('before setTimeout()');
        setTimeout(callback, 1000);
        console.log('after setTimeout()');
//        before setTimeout()
//        after setTimeout()
//        done

        function test(resolve, reject) {
            var timeOut = Math.random() * 2;
            console.log('set timeout to: ' + timeout + 'seconds');
            setTimeout(function () {
                if (timeOut < 1) {
                    console.log('call resolve()');
                    resolve('200 ok');
                } else {
                    console.log('call reject()...');
                    reject('timeout in ' + timeOut + 'seconds.');
                }
            }, timeOut * 1000);
        }

        //变量p1是一个Promise对象，负责执行test函数，由于test函数在内部是异步执行的，当test函数执行成功时
        var p1 = new Promise(test);
        var p2 = p1.then(function (result) {
            console.log('成功：' + result);
        });
        var p3 = p2.catch(function (reason) {
            console.log('失败：' + reason);
        });

        new Promise(test).then(function (result) {
            console.log('success: ' + result);
        }).catch(function (reason) {
            console.log('fail: ' + reason);
        });

        //AJAX异步执行函数转化为Promise对象
        function ajax(method, url, data) {
            var request = new XMLHttpRequest();
            return new Promise(function (resolve, reject) {
                request.onreadystatechange = function () {
                    if (request.readyState === 4) {
                        if (request.status === 200) {
                            resolve(request.responseText);
                        } else {
                            reject(request.status);
                        }
                    }
                }
            });
            request.open(method, url);
            request.send(data);
        }

        var log = document.getElementById('ajax_response');
        var p = ajax('GET', '/api/categories');
        p.then(function (text) { // 如果ajax成功，获得响应内容
            log.innerText = text;
        }).catch(function (status) { // 如果ajax失败，获得响应代码
            log.innerText = 'error: ' + status;
        });
    </script>
</head>
<body>
    <p id="ajax_response"></p>
</body>
=======
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Promise</title>
    <script>
        function callback() {
            console.log('done');
        }
        console.log('before setTimeout()');
        setTimeout(callback, 1000);
        console.log('after setTimeout()');
//        before setTimeout()
//        after setTimeout()
//        done

        function test(resolve, reject) {
            var timeOut = Math.random() * 2;
            console.log('set timeout to: ' + timeout + 'seconds');
            setTimeout(function () {
                if (timeOut < 1) {
                    console.log('call resolve()');
                    resolve('200 ok');
                } else {
                    console.log('call reject()...');
                    reject('timeout in ' + timeOut + 'seconds.');
                }
            }, timeOut * 1000);
        }

        //变量p1是一个Promise对象，负责执行test函数，由于test函数在内部是异步执行的，当test函数执行成功时
        var p1 = new Promise(test);
        var p2 = p1.then(function (result) {
            console.log('成功：' + result);
        });
        var p3 = p2.catch(function (reason) {
            console.log('失败：' + reason);
        });

        new Promise(test).then(function (result) {
            console.log('success: ' + result);
        }).catch(function (reason) {
            console.log('fail: ' + reason);
        });

        //AJAX异步执行函数转化为Promise对象
        function ajax(method, url, data) {
            var request = new XMLHttpRequest();
            return new Promise(function (resolve, reject) {
                request.onreadystatechange = function () {
                    if (request.readyState === 4) {
                        if (request.status === 200) {
                            resolve(request.responseText);
                        } else {
                            reject(request.status);
                        }
                    }
                }
            });
            request.open(method, url);
            request.send(data);
        }

        var log = document.getElementById('ajax_response');
        var p = ajax('GET', '/api/categories');
        p.then(function (text) { // 如果ajax成功，获得响应内容
            log.innerText = text;
        }).catch(function (status) { // 如果ajax失败，获得响应代码
            log.innerText = 'error: ' + status;
        });
    </script>
</head>
<body>
    <p id="ajax_response"></p>
</body>
>>>>>>> e44fb797ae5b3c61b53a91786424728d875849b9
</html>